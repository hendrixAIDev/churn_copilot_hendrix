<!DOCTYPE html>
<html>
<head>
    <title>ChurnPilot localStorage Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
        }
        .success { color: green; }
        .error { color: red; }
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ChurnPilot localStorage Test</h1>
    <p>This page tests if localStorage is working in your browser.</p>

    <div class="test-section">
        <h2>Test 1: Basic localStorage</h2>
        <button onclick="testBasicStorage()">Test Basic Storage</button>
        <div id="basic-result"></div>
    </div>

    <div class="test-section">
        <h2>Test 2: Save Test Card</h2>
        <button onclick="saveTestCard()">Save Test Card</button>
        <button onclick="loadTestCard()">Load Test Card</button>
        <button onclick="clearTestCard()">Clear Test Card</button>
        <div id="card-result"></div>
        <pre id="card-data"></pre>
    </div>

    <div class="test-section">
        <h2>Test 3: ChurnPilot Data</h2>
        <button onclick="viewChurnPilotData()">View ChurnPilot Data</button>
        <button onclick="clearChurnPilotData()">Clear ChurnPilot Data</button>
        <div id="churnpilot-result"></div>
        <pre id="churnpilot-data"></pre>
    </div>

    <div class="test-section">
        <h2>Instructions</h2>
        <ol>
            <li>Click "Test Basic Storage" - should say "SUCCESS"</li>
            <li>Click "Save Test Card" - should save a card</li>
            <li>Close this tab/window completely</li>
            <li>Reopen this HTML file</li>
            <li>Click "Load Test Card" - should show the saved card</li>
            <li>If that works, localStorage is functional</li>
            <li>Then check "View ChurnPilot Data" to see if ChurnPilot is saving data</li>
        </ol>
    </div>

    <script>
        const STORAGE_KEY = 'churnpilot_cards';
        const TEST_KEY = 'churnpilot_test';

        function testBasicStorage() {
            const resultDiv = document.getElementById('basic-result');
            try {
                // Test write
                localStorage.setItem('test', 'hello');

                // Test read
                const value = localStorage.getItem('test');

                // Test delete
                localStorage.removeItem('test');

                if (value === 'hello') {
                    resultDiv.innerHTML = '<p class="success">✓ localStorage is working!</p>';
                } else {
                    resultDiv.innerHTML = '<p class="error">✗ localStorage read failed</p>';
                }
            } catch (e) {
                resultDiv.innerHTML = '<p class="error">✗ localStorage error: ' + e.message + '</p>';
            }
        }

        function saveTestCard() {
            const resultDiv = document.getElementById('card-result');
            const dataDiv = document.getElementById('card-data');

            const testCard = {
                id: 'test-123',
                name: 'Test Card',
                issuer: 'Test Bank',
                annual_fee: 95,
                created_at: new Date().toISOString()
            };

            try {
                localStorage.setItem(TEST_KEY, JSON.stringify([testCard]));
                resultDiv.innerHTML = '<p class="success">✓ Test card saved!</p>';
                dataDiv.textContent = JSON.stringify([testCard], null, 2);
            } catch (e) {
                resultDiv.innerHTML = '<p class="error">✗ Save failed: ' + e.message + '</p>';
            }
        }

        function loadTestCard() {
            const resultDiv = document.getElementById('card-result');
            const dataDiv = document.getElementById('card-data');

            try {
                const data = localStorage.getItem(TEST_KEY);

                if (data) {
                    const cards = JSON.parse(data);
                    resultDiv.innerHTML = '<p class="success">✓ Test card loaded! Found ' + cards.length + ' card(s)</p>';
                    dataDiv.textContent = JSON.stringify(cards, null, 2);
                } else {
                    resultDiv.innerHTML = '<p class="error">✗ No test card found. Did you save one?</p>';
                    dataDiv.textContent = '';
                }
            } catch (e) {
                resultDiv.innerHTML = '<p class="error">✗ Load failed: ' + e.message + '</p>';
            }
        }

        function clearTestCard() {
            const resultDiv = document.getElementById('card-result');
            const dataDiv = document.getElementById('card-data');

            localStorage.removeItem(TEST_KEY);
            resultDiv.innerHTML = '<p>Test card cleared</p>';
            dataDiv.textContent = '';
        }

        function viewChurnPilotData() {
            const resultDiv = document.getElementById('churnpilot-result');
            const dataDiv = document.getElementById('churnpilot-data');

            try {
                const data = localStorage.getItem(STORAGE_KEY);

                if (data) {
                    const cards = JSON.parse(data);
                    resultDiv.innerHTML = '<p class="success">✓ ChurnPilot data found! ' + cards.length + ' card(s)</p>';
                    dataDiv.textContent = JSON.stringify(cards, null, 2);
                } else {
                    resultDiv.innerHTML = '<p>No ChurnPilot data found. Have you added any cards in the app?</p>';
                    dataDiv.textContent = '';
                }
            } catch (e) {
                resultDiv.innerHTML = '<p class="error">✗ Error: ' + e.message + '</p>';
            }
        }

        function clearChurnPilotData() {
            const resultDiv = document.getElementById('churnpilot-result');
            const dataDiv = document.getElementById('churnpilot-data');

            if (confirm('Are you sure you want to clear all ChurnPilot data?')) {
                localStorage.removeItem(STORAGE_KEY);
                resultDiv.innerHTML = '<p>ChurnPilot data cleared</p>';
                dataDiv.textContent = '';
            }
        }

        // Auto-run basic test on load
        window.addEventListener('load', function() {
            testBasicStorage();

            // Check for test card
            const testData = localStorage.getItem(TEST_KEY);
            if (testData) {
                document.getElementById('card-result').innerHTML =
                    '<p class="success">✓ Test card found from previous session!</p>';
                document.getElementById('card-data').textContent =
                    JSON.stringify(JSON.parse(testData), null, 2);
            }
        });
    </script>
</body>
</html>
